{% extends "base_generic.html" %}
{% load todo_template_filters %}
{% load static %}
{% block stylesheet %}
{{ block.super }}
  <link rel="stylesheet" href="{% static 'myuser/css/datepicker.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
{% endblock stylesheet %}
{% block content %}
<div class="container">
  <div class="">
    <div class="btn-group" role="group" aria-label="Basic example">
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        <i class="bi bi-plus-square"></i>
      </button>
      <button type="button" class="btn btn-primary"> 
        <i class="bi bi-pencil-square"></i>
      </button>
      <button type="button" class="btn btn-primary">
        <i class="bi bi-dash-square"></i>
      </button>
    </div>
  </div>

  <div class="">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for todo in todo_qs %}
        <div class="col-sm-6">
          <div class="card" style="width: 18rem;">
            <div class="card-header">
              {{todo.title}}
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                {% for item in todo.todoitem_set|get_related_query_set %}
                  <li class="list-group-item hstack gap-3 form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" {{item.done|add_boolean_attr:"checked"}}>
                      <label class="form-check-label">{{ item.title }}</label>
                      <label class="form-check-label ms-auto">{{ item.due_date }}</label>
                  </li>
                {% endfor %}
              </ul>
            </div>
            <div class="card-footer text-muted">
              <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#itemModal" data-bs-todoid="{{todo.id}}">
                  <i class="bi bi-plus-square"></i>
                </button>
                <button type="button" class="btn btn-primary">
                  <i class="bi bi-pencil-square"></i>
                </button>
                <button type="button" class="btn btn-primary">
                  <i class="bi bi-dash-square"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New Todo List</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action={% url 'todo:todo' %} method="post" class="needs-validation" novalidate>
            {% csrf_token %}
            <!--
            <div class="mb-3">
              <h1 class="h3 mb-3 mt-3 font-weight-normal">Log in</h1>
            </div>
            -->
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input name="title" type="text" class="form-control" id="title" required>
            </div>
            <div class="mb-3">
              <label for="due_date" class="form-label">Due Date</label>
              <input name="due_date" type="text" class="form-control" id="due_date" required readonly placeholder='Select Due Date'>
            </div>
            <div class="mb-3">
              <button type="submit" class="w-100 btn btn-lg btn-warning">Create</button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <!--<button type="button" class="btn btn-primary">Save changes</button>-->
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="itemModalLabel">Add todo item.</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action={% url 'todo:todo_item' %} method="post" class="needs-validation" novalidate>
            {% csrf_token %}
            <!--
            <div class="mb-3">
              <h1 class="h3 mb-3 mt-3 font-weight-normal">Log in</h1>
            </div>
            -->

            <div class="mb-3">
              <label for="todo_list_id" class="form-label">Title</label>
              <input name="todo_list_id" type="text" class="form-control" id="todo_list_id" required>
            </div>
            <div class="mb-3">
              <label for="item_title" class="form-label">Title</label>
              <input name="item_title" type="text" class="form-control" id="item_title" required>
            </div>
            <div class="mb-3">
              <label for="item_due_date" class="form-label">Due Date</label>
              <input name="item_due_date" type="text" class="form-control" id="item_due_date" required readonly placeholder='Select Due Date'>
            </div>
            <div class="mb-3">
              <button type="submit" class="w-100 btn btn-lg btn-warning">Create</button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <!--<button type="button" class="btn btn-primary">Save changes</button>-->
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block script %}
  {{ block.super }}
  <script src="{% static 'myuser/js/datepicker-full.js' %}"></script>
  <script src="{% static 'myuser/js/en-GB.js' %}"></script>
  <script type="text/javascript">
      elem = document.querySelector('#due_date');
      const datepicker = new Datepicker(elem, {
      // options here
          // Whether or not to close the datepicker immediately when a date is selected.
          autohide:true,
          // The string that will appear on top of the datepicker. If empty the title will be hidden.
          title: '',
          // If true, highlights the current date.
          todayHighlight: true,
          // If true, no keyboard will show on mobile devices.
          //this option does not work
          disableTouchKeyboard: true,
          // Date format string.
          format: 'dd/mm/yyyy',
          // Maximum limit to selectable date. No limit is applied if null is set.
          maxDate: null,
          // Minimum limit to selectable date. No limit is applied if null is set.
          minDate: null,
      });

      elem2 = document.querySelector('#item_due_date');
      const datepicker2 = new Datepicker(elem2, {
      // options here
          // Whether or not to close the datepicker immediately when a date is selected.
          autohide:true,
          // The string that will appear on top of the datepicker. If empty the title will be hidden.
          title: '',
          // If true, highlights the current date.
          todayHighlight: true,
          // If true, no keyboard will show on mobile devices.
          //this option does not work
          disableTouchKeyboard: true,
          // Date format string.
          format: 'yyyy/mm/dd',
          // Maximum limit to selectable date. No limit is applied if null is set.
          maxDate: null,
          // Minimum limit to selectable date. No limit is applied if null is set.
          minDate: null,
      });
      //elem.addEventListener('keydown', function(e){ 
        //e.preventDefault();
      //});

      const itemModal = document.getElementById('itemModal');
      itemModal.addEventListener('show.bs.modal', event => {
        // Button that triggered the modal
        const button = event.relatedTarget
        // Extract info from data-bs-* attributes
        const todoListId = button.getAttribute('data-bs-todoid')
        // If necessary, you could initiate an AJAX request here
        // and then do the updating in a callback.
        //
        // Update the modal's content.
        //const modalTitle = itemModal.querySelector('.modal-title')
        const todoListIdInput = itemModal.querySelector('#todo_list_id')

        //modalTitle.textContent = `New message to ${recipient}`
        todoListIdInput.value = todoListId
      })
  </script>
{% endblock script %}
